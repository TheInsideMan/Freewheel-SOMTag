<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Discovery Video + Freewheel + SOMTag</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
	<link href="//cs1.brightcodes.net/jsaavedra/includes/css/styles.css" rel="stylesheet">
	<link href="//players.brightcove.net/videojs-freewheel/2/videojs-freewheel.min.css" rel="stylesheet">	  	
	<style>
</style>
<script>
	function GetParameterByName(name) {
		console.log("inside GetParameterByName");
		name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
		var regexS = "[\\?&]" + name + "=([^&#]*)";
		var regex = new RegExp(regexS);
		var results = regex.exec(window.location.href);
		if (results == null)
			return "";
		else
			return decodeURIComponent(results[1].replace(/\+/g, " "));
	}
</script>  
<script>
	(function (s, o, m, t, a, g) {
	    s.somtag = {
	      	cmd: function () {
				g = [].slice.call(arguments);
				g.push(o.currentScript || o.scripts[o.scripts.length - 1]); (this.q = this.q || []).push(g);
			} };
		o.write('<script src="' + m + '" async><' + '/script>'); 
	})(window, document, '//ad.71i.de/somtag/loader/loader.js');
</script>
</head>

<body>
	<div class="container">
		<h1>Discovery Video + Freewheel + SOMTag</h1>
		<div style="position: relative; display: block; max-width: 100%;">
			<div style="padding-top: 56.25%;">

				<video data-video-id="5671185720001" 
				data-account="1659832546" 
				data-player="SJOn9gShW" 
				id="myPlayerID"
				data-embed="default" 
				data-application-id 
				class="video-js" 
				style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; width: 100%; height: 100%;"
				controls></video>
				<script src="//players.brightcove.net/1659832546/SJOn9gShW_default/index.min.js"></script>
				<script src="//players.brightcove.net/videojs-freewheel/2/videojs-freewheel.min.js"></script>
				

			</div>
		</div>
		<div class="alert alert-warning" role="alert">
			These are examples to demonstrate certain features and functionality of Brightcove products and services and are provided for demonstration purposes only. These examples are not to be used in production and are not supported by Brightcove or the Brightcove support team.
		</div>
	</div>

	<script type="text/javascript">
		
		// somtag.cmd('init', { id: 'tlcde'}); 
		somtag.cmd('init', { "config" : {"id": "tlcde"}});
		somtag.cmd('getPageTargeting', {}, function(error, result) {
			var targeting = []; 
			for(var p in result) {
				targeting.push(p + "=" + result[p]); 
			}
			var targetingParameter = encodeURIComponent(targeting.join('&')); 
			var random = String(Math.random()).substr(2,9);
			var zone = 'other';
			var somPrerollTemplate ='https://ad.yieldlab.net/yp/3922339?pvid=1&' + 't=NUGGVARS&type=vast&redirect=https%3A%2F%2Fpubads.g.doubleclick.net%2F' + 'gampad%2Fadx%3Fiu%3D%2F5731%2Fdevelop.video%2FZONE%26sz%3D10x1%26tile%' + '3D1%26t%3D%2526vtype%253D1%2526pos%253D1%2526vpos%253D1%2526idf%253Dsom' +
			 '%2526deliver%253Dyp%2526%5Bypkws%5D%26d_imp%3D1%26m%3Dtext%2Fxml%26c' + '%3DRANDOM';
			var somPrerollTag = somPrerollTemplate .replace('NUGGVARS', targetingParameter) .replace('RANDOM', random) .replace('ZONE', zone);
			// ... same for midroll / postroll ad urls ... });
			console.log(somPrerollTag);
			// console.log(encodeURIComponent(somPrerollTag));
			var som_url = encodeURIComponent(somPrerollTag);
			console.log(som_url);
			console.log("starting body js");
			var myPlayer;

			videojs("myPlayerID").ready(function(){
				/* get a reference to the player */
				myPlayer= this;

				var fw = GetParameterByName('fw');
				if(fw==1)  {
					console.log("inside fw=1");
					myPlayer.FreeWheelPlugin(
					{
						"adTechOrder":["html5","flash"],
						"prerollTimeout":50000,
						"timeout":50000,
						"debug":true,
						"Html5":{
							"networkId":48746,
							"profile":"48746:DiscoveryIntl_BrightcoveJS",
							"sdkurl":"https://mssl.fwmrm.net/p/DI_live/AdManager.js",
							"serverUrl":"https://be6b.v.fwmrm.net/ad/g/1",
							"siteSectionCustomId":"TLC_DE_DESKTOP_HOMEPAGE		",
							"siteSectionFallbackId":1201033,
							"videoAssetFallbackId":"0",
							"videoAssetCustomId": "DPLAYSE_SV_EHD_952757D",
							"keyValues": [{
								"som_url": som_url
							}]
						},
						"Flash": {
							"networkId":48746,
							"profile":"48746:DiscoveryIntl_BrightcoveJS",
							"sdkurl":"https://mssl.fwmrm.net/p/DI_live/AdManager.swf",
							"serverUrl":"https://be6b.v.fwmrm.net/ad/g/1",
							"swfurl":"https://players.brightcove.net/videojs-freewheel/2/videojs.freewheel.swf",
							"siteSectionCustomId":"TLC_DE_DESKTOP_HOMEPAGE",
							"siteSectionFallbackId":1201033,
							"videoAssetFallbackId":"0",
							"videoAssetCustomId": "DPLAYSE_SV_EHD_952757D"
						}
					});
				} 
				if(fw==2)  {
					console.log("inside fw=1");
					myPlayer.FreeWheelPlugin(
					{
						"adTechOrder":["html5","flash"],
						"prerollTimeout":50000,
						"timeout":50000,
						"debug":true,
						"Html5":{
							"networkId":48747,
							"profile":"48747:DiscoveryIntl_BrightcoveJS_secure",
							"sdkurl":"https://mssl.fwmrm.net/p/DI_live/AdManager.js",
							"serverUrl":"https://be6b.v.fwmrm.net/ad/g/1",
							"siteSectionCustomId":"DISCOVERY_CHANNEL_FR_HOMEPAGE",
							"siteSectionFallbackId":6909578,
							"videoAssetFallbackId":"0",
							// "keyValues":[
							// {"flag":"2bamcb","inskin_yes":"true","_fw_fss":"TESTING_DMAX_GERMANY_2_SERIES_1_QUEEN_OF_THE_SOUTH"}
							// ],
							// "videoAssetCustomId": '{mediainfo.reference_id}'
							"videoAssetCustomId": "141753030"
						},
						"Flash": {
							"networkId":48747,
							"profile":"48747:DiscoveryIntl_Brightcove_secure",
							"sdkurl":"https://mssl.fwmrm.net/p/DI_live/AdManager.swf",
							"serverUrl":"https://be6b.v.fwmrm.net/ad/g/1",
							// "swfurl":"https://players.brightcove.net/videojs-freewheel/videojs.freewheel.swf",
							"swfurl":"https://players.brightcove.net/videojs-freewheel/2/videojs.freewheel.swf",
							"siteSectionCustomId":"DISCOVERY_CHANNEL_FR_HOMEPAGE",
							"siteSectionFallbackId":6909578,
							"videoAssetFallbackId":"0",
							// "keyValues":[
							// {"flag":"2bamcb","inskin_yes":"true","_fw_fss":"TESTING_DMAX_GERMANY_2_SERIES_1_QUEEN_OF_THE_SOUTH"}
							// ],
							// "videoAssetCustomId": "{mediainfo.reference_id}"
							"videoAssetCustomId": "141753030"
						}
					});
				} 
				
				if(fw==3)  {
					myPlayer.FreeWheelPlugin(
					{
						"adTechOrder":["html5","flash"],
						"prerollTimeout":50000,
						"timeout":50000,
						"debug":true,
						"Html5":{
							"networkId":48747,
							"profile":"48747:DiscoveryIntl_BrightcoveJS_secure",
							"sdkurl":"https://mssl.fwmrm.net/p/DI_live/AdManager.js",
							"serverUrl":"https://be6b.v.fwmrm.net/ad/g/1",
							"siteSectionCustomId":"TESTING_DMAX_GERMANY_2_SERIES_1_QUEEN_OF_THE_SOUTH",
							"siteSectionFallbackId":6942797,
							"videoAssetFallbackId":"0",
							// "keyValues":[
							// {"flag":"2bamcb","inskin_yes":"true","_fw_fss":"TESTING_DMAX_GERMANY_2_SERIES_1_QUEEN_OF_THE_SOUTH"}
							// ],
							// "videoAssetCustomId": '{mediainfo.reference_id}'
							"videoAssetCustomId": "141753030"
						},
						"Flash": {
							"networkId":48747,
							"profile":"48747:DiscoveryIntl_Brightcove_secure",
							"sdkurl":"https://mssl.fwmrm.net/p/DI_live/AdManager.swf",
							"serverUrl":"https://be6b.v.fwmrm.net/ad/g/1",
							"swfurl":"https://players.brightcove.net/videojs-freewheel/2/videojs.freewheel.swf",
							"siteSectionCustomId":"TESTING_DMAX_GERMANY_2_SERIES_1_QUEEN_OF_THE_SOUTH",
							"siteSectionFallbackId":6942797,
							"videoAssetFallbackId":"0",
							// "keyValues":[
							// {"flag":"2bamcb","inskin_yes":"true","_fw_fss":"TESTING_DMAX_GERMANY_2_SERIES_1_QUEEN_OF_THE_SOUTH"}
							// ],
							// "videoAssetCustomId": "{mediainfo.reference_id}"
							"videoAssetCustomId": "141753030"
						}
					});
				}   





			});
			});
		




	</script>

	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
</body>
</html>